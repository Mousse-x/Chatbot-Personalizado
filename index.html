<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agujeros Negros - Explora el Universo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
    <!-- Encabezado -->
    <header class="bg-black bg-opacity-50 p-6 text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">Agujeros Negros</h1>
        <p class="text-lg md:text-xl text-gray-300">Descubre los misterios de los fenómenos más fascinantes del universo</p>
    </header>

    <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>
    <df-messenger
    project-id="high-sunlight-473714-i7"
    agent-id="6f87f962-480f-44d5-acdc-8a1127c97f16"
    language-code="en"
    max-query-length="-1">
    <df-messenger-chat-bubble
        chat-title="Max">
    </df-messenger-chat-bubble>
    </df-messenger>
    <style>
        df-messenger {
            z-index: 999;
            position: fixed;
            --df-messenger-font-color: #000;
            --df-messenger-font-family: Google Sans;
            --df-messenger-chat-background: #f3f6fc;
            --df-messenger-message-user-background: #d3e3fd;
            --df-messenger-message-bot-background: #fff;
            bottom: 16px;
            right: 16px;
        }
    </style>

    <!-- Contenido Principal -->
    <main class="max-w-4xl mx-auto p-6">
        <!-- Sección de Introducción -->
        <section class="mb-12">
            <h2 class="text-3xl font-semibold mb-4">¿Qué es un agujero negro?</h2>
            <p class="text-gray-300 leading-relaxed">
                Un agujero negro es una región del espacio-tiempo con una gravedad tan intensa que nada, ni siquiera la luz, puede escapar de ella. Se forman cuando una estrella masiva colapsa bajo su propia gravedad al final de su ciclo de vida, creando una singularidad rodeada por un horizonte de eventos.
            </p>
        </section>

        <!-- Sección de Características -->
        <section class="mb-12">
            <h2 class="text-3xl font-semibold mb-4">Características principales</h2>
            <ul class="list-disc list-inside text-gray-300 space-y-2">
                <li><strong>Horizonte de eventos:</strong> El límite invisible que marca el punto de no retorno.</li>
                <li><strong>Singularidad:</strong> El centro donde la densidad es teóricamente infinita.</li>
                <li><strong>Disco de acreción:</strong> Material que orbita y cae hacia el agujero negro, emitiendo radiación.</li>
                <li><strong>Tipos:</strong> Estelares, supermasivos, primordiales y de Kerr (rotatorios).</li>
            </ul>
        </section>

        <!-- Sección de Imagen -->
        <section class="mb-12">
            <h2 class="text-3xl font-semibold mb-4">Visualización de un agujero negro</h2>
            <div class="flex justify-center">
                <img src="https://via.placeholder.com/600x400?text=Agujero+Negro" alt="Ilustración de un agujero negro" class="rounded-lg shadow-lg max-w-full h-auto">
            </div>
            <p class="text-gray-400 text-center mt-4">Representación artística de un agujero negro con su disco de acreción.</p>
        </section>

        <!-- Sección de Curiosidades -->
        <section class="mb-12">
            <h2 class="text-3xl font-semibold mb-4">Curiosidades sobre agujeros negros</h2>
            <p class="text-gray-300 leading-relaxed">
                Los agujeros negros no solo son objetos de estudio en la astrofísica, sino que también han capturado la imaginación popular. Algunos hechos interesantes incluyen:
            </p>
            <ul class="list-disc list-inside text-gray-300 space-y-2 mt-4">
                <li>El primer agujero negro fotografiado fue en 2019 por el Event Horizon Telescope, ubicado en la galaxia M87.</li>
                <li>Los agujeros negros supermasivos, que residen en el centro de galaxias, pueden tener masas de millones o miles de millones de veces la del Sol.</li>
                <li>La radiación de Hawking sugiere que los agujeros negros pueden evaporarse con el tiempo al emitir partículas.</li>
            </ul>
        </section>
    </main>

    <!-- Pie de página -->
    <footer class="bg-black bg-opacity-50 p-6 text-center text-gray-400">
        <p>&copy; 2025 Explora el Universo. Todos los derechos reservados.</p>
    </footer>
    <!-- Botón de entrada por voz y TTS -->
    <div id="voice-ui" style="position:fixed; right:96px; bottom:24px; z-index:1000; display:flex; flex-direction:column; align-items:center; gap:8px;">
        <button id="mic-btn" aria-label="Iniciar dictado" title="Hablar" style="width:56px; height:56px; border-radius:50%; background:#ef4444; border:none; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 18px rgba(0,0,0,0.5); cursor:pointer;">
            <svg id="mic-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="white"><path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 0 0-6 0v5a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 14 0h-2z"/></svg>
        </button>
        <div id="voice-status" style="min-width:140px; background:rgba(0,0,0,0.6); color:#fff; padding:6px 10px; border-radius:8px; font-size:13px; text-align:center;">Micro: inactivo</div>
    </div>

    <script>
        // Voz: Entrada por voz (SpeechRecognition) y salida con SpeechSynthesis
        (function(){
            const micBtn = document.getElementById('mic-btn');
            const statusEl = document.getElementById('voice-status');
            let recognizing = false;
            let recognition = null;
            let lastBotText = '';

            // Inicializar SpeechRecognition (compatible Chrome/Edge)
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                statusEl.textContent = 'SpeechRecognition no soportado';
                micBtn.disabled = true;
            } else {
                recognition = new SpeechRecognition();
                recognition.lang = 'es-ES';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onstart = () => {
                    recognizing = true;
                    micBtn.style.background = '#ef4444';
                    statusEl.textContent = 'Escuchando...';
                };

                recognition.onend = () => {
                    recognizing = false;
                    micBtn.style.background = '#10b981';
                    setTimeout(()=>{ micBtn.style.background = '#ef4444'; }, 800);
                    statusEl.textContent = 'Micro: inactivo';
                };

                recognition.onerror = (e) => {
                    console.warn('Recognition error', e);
                    statusEl.textContent = 'Error de reconocimiento';
                    recognizing = false;
                };

                recognition.onresult = (event) => {
                    const transcript = Array.from(event.results).map(r=>r[0].transcript).join('');
                    statusEl.textContent = 'Transcripción: ' + transcript;
                    sendToDialogflow(transcript);
                };
            }

            micBtn.addEventListener('click', ()=>{
                if (!recognition) return;
                if (recognizing) {
                    recognition.stop();
                } else {
                    try { recognition.start(); } catch(e) { console.warn(e); }
                }
            });

            // Intenta enviar el texto al widget `df-messenger` de Dialogflow
            function sendToDialogflow(text){
                const df = document.querySelector('df-messenger');
                if (!df) {
                    console.warn('df-messenger no encontrado. Texto: ', text);
                    speakText(text); // si no hay widget, lee lo que dijo el usuario (útil para debug)
                    return;
                }

                // Si el componente expone un método público desconocido, pruebo algunas variantes
                try {
                    if (typeof df.send === 'function') { df.send(text); return; }
                    if (typeof df.renderCustomText === 'function') { df.renderCustomText(text); return; }
                } catch(e){ console.warn('Error calling df methods', e); }

                // Intenta localizar el campo de entrada dentro del Shadow DOM y simular el envío
                try {
                    const root = df.shadowRoot || df;
                    const input = root.querySelector('textarea, input[type=text], input[type=search]');
                    if (input) {
                        input.focus();
                        // Poner valor y disparar evento de entrada
                        input.value = text;
                        input.dispatchEvent(new Event('input', {bubbles:true}));

                        // Buscar botón de enviar
                        const btnSelectors = ['button[aria-label="Send Message"]','button[aria-label="Enviar"]','button.send','button.primary','df-messenger-send'];
                        let btn = null;
                        for (const s of btnSelectors){ btn = root.querySelector(s); if (btn) break; }
                        if (btn) {
                            btn.click();
                        } else {
                            // Simular Enter
                            const ev = new KeyboardEvent('keydown', {key:'Enter', code:'Enter', keyCode:13, which:13, bubbles:true});
                            input.dispatchEvent(ev);
                        }
                    } else {
                        console.warn('No se encontró input dentro de df-messenger. Intentando renderCustomText.');
                        if (typeof df.renderCustomText === 'function') df.renderCustomText(text);
                    }
                } catch(e){
                    console.warn('No fue posible enviar al df-messenger vía DOM.', e);
                }
            }

            // Observador para captar las respuestas del bot dentro de df-messenger y transformarlas a audio
            function observeBotResponses(){
                const df = document.querySelector('df-messenger');
                if (!df) return;
                const root = df.shadowRoot || df;
                if (!root) return;

                const observer = new MutationObserver((mutations)=>{
                    try {
                        // Buscar textos aparentes del bot
                        const texts = gatherTextsFromRoot(root);
                        if (texts.length===0) return;
                        const last = texts[texts.length-1];
                        if (last && last !== lastBotText) {
                            lastBotText = last;
                            speakText(last);
                        }
                    } catch(e){ console.warn('Observer error', e); }
                });

                observer.observe(root, {childList:true, subtree:true});
            }

            function gatherTextsFromRoot(root){
                const results = [];
                // Intento seleccionar mensajes tipicos
                const candidateSelectors = ['df-message','div.message','div.msg','div.chat-message','div.agent-message','div.bot-message','p'];
                candidateSelectors.forEach(sel=>{
                    try{ root.querySelectorAll(sel).forEach(el=>{ const t = el.innerText || el.textContent; if (t && t.trim()) results.push(t.trim()); }); }catch(e){}
                });
                // Fallback: buscar bloques de texto largos
                if (results.length===0){
                    root.querySelectorAll('span, p, div').forEach(el=>{
                        const t = el.innerText || el.textContent;
                        if (t && t.trim().length>30) results.push(t.trim());
                    });
                }
                return results;
            }

            // Función TTS usando Web Speech API (SpeechSynthesis)
            function speakText(text){
                if (!window.speechSynthesis) {
                    console.warn('SpeechSynthesis no soportado por el navegador.');
                    return;
                }
                const utter = new SpeechSynthesisUtterance(text);
                utter.lang = 'es-ES';
                // Elegir una voz en español si existe
                const voices = window.speechSynthesis.getVoices();
                let v = voices.find(x=>/es-/.test(x.lang)) || voices.find(x=>/Spanish/i.test(x.name)) || voices[0];
                if (v) utter.voice = v;
                window.speechSynthesis.cancel(); // cancelar si hay en curso
                window.speechSynthesis.speak(utter);
            }

            // Esperar que el df-messenger cargue y luego iniciar observador
            window.addEventListener('load', ()=>{
                setTimeout(()=>{ observeBotResponses(); }, 1200);
                // mejorar compatibilidad: cargar voces (some browsers async)
                if (window.speechSynthesis) window.speechSynthesis.getVoices();
            });
        })();
    </script>
</body>
</html>

